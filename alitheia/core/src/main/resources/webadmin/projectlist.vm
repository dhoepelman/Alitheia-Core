#set($section=3)
#parse("header.vm")

        <div id="contents">
          <h2>$tr.label("projects_mngm")</h2>
          
          ## Display project list
          <div id="table">
            
            <form id="projects" name="projects" method="post" action="/projects">
              <table>
                <thead>
                  <tr class="head">
                    <td class="head" style="width: 10%;">Project Id</td>
                    <td class="head" style="width: 35%;">Project Name</td>
                    <td class="head" style="width: 15%;">Last Version</td>
                    <td class="head" style="width: 15%;">Last Email</td>
                    <td class="head" style="width: 15%;">Last Bug</td>
                    <td class="head" style="width: 10%;">Evaluated</td>
                    <td class="head" style="width: 10%;">Host</td>
                  </tr>
                </thead>
                <tbody>
                
           	  ## Display projects
          	  #if ($projectList.isEmpty())
              	  <tr>
                    <td colspan="6" class="noattr">
                      No projects found.
                    </td>
                  </tr>
          	  #else
                  #foreach ($project in $projectList)
	                  #set ($isSelProj = $selProject.getId() == $project.getId())
	                  <tr class="#if ($isSelProj) selected #else edit #end" onclick="javascript:document.getElementById('REQ_PAR_PROJECT_ID').value='#if (!$isSelProj) $project.getId() #end (';document.projects.submit();">
                        <td class="trans">$project.getId()</td>
	                    <td class="trans">
	                      <img src="/edit.png" alt="[Edit]"/>
	                      #if ($isSelProj)
	                      	<input type="button" class="install" style="width: 100px;" value="Info" onclick="javascript:document.getElementById('REQ_PAR_ACTION').value='ACT_REQ_SHOW_PROJECT';document.projects.submit();">
	                      #end
	                      &nbsp;$project.getName()
	                    </td>
	                    <td class="trans">$getLastProjectVersion($project)</td>
	                    <td class="trans">$getLatestMailMessage($project)</td>
	                    <td class="trans">$getLastBugUpdate($project)</td>
	                    <td class="trans">
	                      #if ($project.isEvaluated())
	                      	$tr.label("project_is_evaluated")
	                      #else
	                      	$tr.label("project_not_evaluated")
	                      #end
	                    </td>
	                    <td class="trans">$getClusternode($project)</td>
	                  </tr>
	                  
	                  ## Add metric if this project is opened
	                  #if ($isSelProj)
		                  #foreach ($metric in $installedMetrics)
			                  <tr>
			                    <td colspan="7" class="noattr">
			                      <input type="button" class="install" style="width: 100px;" value="Synchronise" onclick="javascript:document.getElementById('REQ_PAR_SYNC_PLUGIN').value='$metric.getHashcode()';document.projects.submit();">&nbsp;$metric.getPluginName()
			                    </td>
			                  </tr>
	                      #end
                      #end
	                  
	              #end
	          #end
                
                  ## Add toolbar
              #if ($isProjectSelected)
                  #set ($disabled = "disabled")
                  #set ($projectLocation = "")
              #else
                  #set ($disabled = "")
                  #set ($projectLocation = "?" + "REQ_PAR_PROJECT_ID" + "=" + $selProject.getId())
              #end
                  
                  <tr class="subhead">
                    <td>View</td><td colspan="6">
                      <input type="button" class="install" style="width: 100px;" value="Refresh" onclick="javascript:window.location='/projects$projectLocation';">
                    </td>
                  </tr>
                  
                  <tr class="subhead">
                    <td>Manage</td>
                    <td colspan='6'>
                      <input type="button" class="install" style="width: 100px;" value="Add project" onclick="javascript:document.getElementById('REQ_PAR_ACTION').value='ACT_REQ_ADD_PROJECT';document.projects.submit();">
                      <input type="button" class="install" style="width: 100px;" value="Delete project" onclick="javascript:document.getElementById('REQ_PAR_ACTION').value='ACT_REQ_REM_PROJECT';document.projects.submit();" $disabled>
                    </td>
                  </tr>
                  
                  <tr class='subhead'>
                    <td>Update</td>
                    <td colspan='4'>
                      ## Loop through all updaters and display them in a select
                      #if ($isSelProj)
	                      #set ($stages = ["Import Stage", "Parse Stage", "Inference Stage", "Default Stage"];
	                      <select name="reqUpd" id="reqUpd">
	                        #foreach ($updaterStage in $getUpdaters())
								<optgroup label="$stages[$count]">
								#set ($list = $updaterStage.get($stages[$count])) 
								#foreach ($updater in $list)
								    <option value="$updater.mnem">$updater.descr</option>
						        #end
							</optgroup>
						#end
					</select>
                      #end 
                      <input type="button" class="install" value="Run Updater" onclick="javascript:document.getElementById('REQ_PAR_ACTION').value='ACT_CON_UPD';document.projects.submit();" $disabled />
                      <input type="button" class="install" value="Run All Updaters" onclick="javascript:document.getElementById('REQ_PAR_ACTION').value='ACT_CON_UPD_ALL';document.projects.submit();" $disabled />
                    </td>
                    <td colspan="2" align="right">
                      <input type="button" class="install" value="Update all on $sobjClusterNode.getClusterNodeName()" onclick="javascript:document.getElementById('REQ_PAR_ACTION').value='ACT_CON_UPD_ALL_NODE';document.projects.submit();" />
                    </td>
                  </tr>
                </tbody>
              </table>
          
              <input type="hidden" id="REQ_PAR_ACTION" name="REQ_PAR_ACTION" value="" />
              <input type="hidden" id="REQ_PAR_PROJECT_ID" name="REQ_PAR_PROJECT_ID" value="$selProject.getId()" />
              <input type="hidden" id="REQ_PAR_SYNC_PLUGIN" name="REQ_PAR_SYNC_PLUGIN" value="" />
            </form>

          </div>
          
          ## Display fast way to install new project
          <h2>$tr.label("install_new_project")</h2>
          <form id="addprojectdir" method="post" action="diraddproject">
            $tr.label("project_info_txt")
            <input name="info" type="text" alt="$tr.label("project_info_txt_help")" class="form" size="40" />
            <input type="submit" value="$tr.label("project_info_txt_install")"/>
          </form>
        </div>

#parse("footer.vm")